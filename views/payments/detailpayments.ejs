<% if (typeof payment !=='undefined' && payment) { %>
    <div class="bg-white p-8 card">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Payment Details: #<%= payment._id %>
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Payment Information</h2>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li>Payment ID: <span class="font-medium">
                            <%= payment._id %>
                        </span></li>
                    <li>Status:
                        <span class="status-badge status-<%= payment.status.toLowerCase().replace(' ', '-') %>">
                            <%= payment.status %>
                        </span>
                    </li>
                    <li>Amount: <span class="font-medium">$<%= payment.amount.toFixed(2) %></span></li>
                    <li>Phone Number: <span class="font-medium">
                            <%= payment.phoneNumber || 'N/A' %>
                        </span></li>
                    <li>Initiated On: <%= new Date(payment.createdAt).toLocaleString() %>
                    </li>
                    <% if (payment.completedAt) { %>
                        <li>Completed On: <%= new Date(payment.completedAt).toLocaleString() %>
                        </li>
                        <% } %>
                            <% if (payment.mpesaRequest && payment.mpesaRequest.CheckoutRequestID) { %>
                                <li>Checkout Request ID: <span class="font-medium">
                                        <%= payment.mpesaRequest.CheckoutRequestID %>
                                    </span></li>
                                <% } %>
                                    <% if (payment.mpesaCallback && payment.mpesaCallback.MpesaReceiptNumber) { %>
                                        <li>M-Pesa Receipt: <span class="font-medium text-green-600">
                                                <%= payment.mpesaCallback.MpesaReceiptNumber %>
                                            </span></li>
                                        <li>Transaction Date: <%= new
                                                Date(payment.mpesaCallback.TransactionDate).toLocaleString() %>
                                        </li>
                                        <% } %>
                                            <% if (payment.mpesaCallback && payment.mpesaCallback.ResultDesc) { %>
                                                <li>M-Pesa Result: <%= payment.mpesaCallback.ResultDesc %>
                                                </li>
                                                <% } %>
                </ul>
            </div>
            <div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Related Order</h2>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li>Order ID: <span class="font-medium">
                            <%= payment.order ? payment.order._id : 'N/A' %>
                        </span></li>
                    <li>Order Total: <span class="font-medium">$<%= payment.order ? payment.order.totalAmount.toFixed(2)
                                : 'N/A' %></span></li>
                    <li>Order Status: <span class="font-medium">
                            <%= payment.order ? payment.order.status : 'N/A' %>
                        </span></li>
                    <li>Customer: <span class="font-medium">
                            <%= payment.user ? payment.user.name : 'N/A' %> (<%= payment.user ? payment.user.email
                                    : 'N/A' %>)
                        </span></li>
                    <% if (payment.order && payment.order.shippingAddress) { %>
                        <li>Shipping Address:
                            <%= payment.order.shippingAddress.street %>,
                                <%= payment.order.shippingAddress.city %>,
                                    <%= payment.order.shippingAddress.country %>
                        </li>
                        <% } %>
                </ul>
                <% if (payment.order) { %>
                    <a href="/api/orders/orders/<%= payment.order._id %>"
                        class="btn btn-secondary mt-4 inline-block">View Order
                        Details</a>
                    <% } %>
            </div>
        </div>

        <% if (payment.status==='initiated' || payment.status==='pending_confirmation' ) { %>
            <div class="bg-gray-50 p-6 card mt-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Check Payment Status</h2>
                <p class="text-gray-700 mb-4">If you initiated the M-Pesa prompt but haven't received confirmation, you
                    can query the status here.</p>
                <form action="/api/payments/payments/status/<%= payment.mpesaRequest.CheckoutRequestID %>" method="GET">
                    <button type="submit" class="btn btn-primary px-6 py-3 text-lg">Query M-Pesa Status</button>
                </form>
            </div>
            <% } %>
    </div>
    <% } else { %>
        <div class="text-center text-gray-600 py-12 bg-white card">
            <h1 class="text-3xl font-bold mb-4">Payment Not Found</h1>
            <p>The payment record you are looking for does not exist.</p>
            <a href="/api/payments/payments/my-payments" class="btn btn-primary mt-6 inline-block">Back to My
                Payments</a>
        </div>
        <% } %>